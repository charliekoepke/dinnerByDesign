// VIDEO ID: xlnvkOemQI4
const steakprep = JSON.parse(`{
   "recipe": [
      {"line": "Gather your ingredients - your steak should be at room temperature.", "time": 0},
      {"line": "Prep your shallot by cutting off both ends, cutting in half, removing the peels, then cutting each half in half.", "time": 3180},
      {"line": "Generously season both sides of your steak with salt and pepper from about 10 inches away.", "time": 63140},
      {"line": "Prepare your garnish - pick cilantro off of stems & thinly slice your scallion.", "time": 150160}
   ]
}`);

// VIDEO ID: R_QLdbfLGZ0
const steakcook = JSON.parse(`{
   "recipe": [
      {"line": "Add a drizzle of olive oil to a carbon steel pan and turn the heat to high.", "time": 0},
      {"line": "Once the pan is hot, add in your steaks.", "time": 5080},
      {"line": "After about 90 seconds, flip your steaks.", "time": 38140},
      {"line": "After 30 seconds, add in your butter, garlic, and shallots and baste the steaks. Allow them to continue cooking while basting for an additional 90 seconds. **Timing will vary based on cook preference & thickness of steaks**", "time": 53040},
      {"line": "Remove steaks from the pan and allow to rest for 5 minutes.", "time": 147160},
      {"line": "Meanwhile put the pan with the garlic and shallots back on to medium - high heat and allow to cook until shallots are translucent and garlic is golden brown.", "time": 158180},
      {"line": "Place the cooked garlic and shallots on a cutting board, and pour the butter into the rice.", "time": 199010},
      {"line": "Add a drizzle of sesame oil to the rice and gently fluff the rice to combine.", "time": 215080},
      {"line": "Mince the cooked shallot and garlic and add to the rice gently folding to combine.", "time": 226090}
   ]
}`);

// VIDEO ID: Gqay2XoYqcY
const soycuredegg = JSON.parse(`{
   "recipe": [
      {"line": "Gather your ingredients.", "time": 0},
      {"line": "Peel ginger with a small spoon.", "time": 4150},
      {"line": "Grate ginger into a small bowl with a microplane.", "time": 19060},
      {"line": "Add 6 tbsp of soy sauce to the bowl.", "time": 40160},
      {"line": "Gently roll your limeto release the juices, and cut in half.", "time": 60220},
      {"line": "Thinly slice the thai chili and add to the bowl.", "time": 73200},
      {"line": "Squeeze lime into the bowl.", "time": 113210},
      {"line": "Stir to combine.", "time": 144160},
      {"line": "Separate egg yolk from white and place gently into a small bowl.", "time": 148130},
      {"line": "Gently pour sauce over egg yolks.", "time": 188240},
      {"line": "Cover yolks with a paper towel and fold the edges over the top. This will pull liquid over the top of the yolks since they float.", "time": 197140},
      {"line": "Refrigerate for at least 1 hour.", "time": 205150}
   ]
}`);

// VIDEO ID: XeRD00WTsQ8
const mushroomprep = JSON.parse(`{
   "recipe": [
      {"line": "Gather your ingredients.", "time": 0},
      {"line": "Remove the stems from your mushrooms.", "time": 6100},
      {"line": "Slice your mushrooms into Â¼ inch slices.", "time": 29030},
      {"line": "Finely chop your garlic.", "time": 55210}
   ]
}`);

// VIDEO ID: bNdiE0umUZc
const mushroomcook = JSON.parse(`{
   "recipe": [
      {"line": "Put a nonstick pan on high heat and allow it to get hot. Once it is hot, add your mushrooms to the dry pan.", "time": 0},
      {"line": "Stir and move the mushrooms semi frequently. You should hear them squeaking against the pan. Allow them to shrink down about 10% and the edges will turn golden brown. ", "time": 3240},
      {"line": "Once the edges are browned, add in your butter and garlic.", "time": 43050},
      {"line": "Cook the mushrooms, butter and garlic until the garlic is golden brown.", "time": 50030}
   ]
}`);

// VIDEO ID:
const aromaticrice = JSON.parse(`{
   "recipe":
   [
      {"line": "Measure out 1 and 1/2 cups of medium grain rice and add to a rice cooker.", "time": 0},
      {"line": "Rinse the rice thouroughly until the water is clear.", "time": 31700},
      {"line": "Add 2 cups of water to the rice cooker.", "time": 102090},
      {"line": "Allow the rice to soak for 15 minutes then press cook on the rice cooker.", "time": 114080}
   ]
}`);

// VIDEO ID:
const cherriesprep = JSON.parse(`{
   "recipe": [
      {"line": "Gather your tools and ingredients.", "time": 0},
      {"line": "Wash your cherries.", "time": 8000},
      {"line": "Use a metal straw to remove the pit from the cherries.", "time": 12200},
      {"line": "Julienne and shallot.", "time": 37110},
      {"line": "Add shallots, cherries, vinegars, water, and brown sugar to a sauce pan.", "time": 99090}
   ]
}`);

// VIDEO ID:
const cherriescook = JSON.parse(`{
   "recipe": [
      {"line": "Put sauce pan on medium high heat.", "time": 0},
      {"line": "Bring to a simmer and stir to incorporate and gently break up the cherries.", "time": 8170},
      {"line": "Reduce heat to medium-low and allow to reduce until thickened to a syrup and cherries are broken down.", "time": 18090},
      {"line": "Add a pinch of salt and pepper and stir in about a tablespoon of duck fat.", "time": 34110}
   ]
}`);

// VIDEO ID:
const duckprep = JSON.parse(`{
   "recipe": [
      {"line": "Gather tools and ingredients.", "time": 0},
      {"line": "Pat duck breast dry.", "time": 8080},
      {"line": "Score skin with chef's knife.", "time": 25040},
      {"line": "Season with salt on both sides, and pepper on the meat side.", "time": 137130}
   ]
}`);

// VIDEO ID:
const duckcook = JSON.parse(`{
   "recipe": [
      {"line": "Place skin side down in a cold pan on low-medium heat.", "time": 0},
      {"line": "Allow skin to render until the fat has rendered and is crispy.", "time": 3110},
      {"line": "Flip over and baste with duck fat - allow to cook on meat side on medium heat for 90 seconds - adjust time for thicker duck breast.", "time": 14210},
      {"line": "Allow duck to rest for 8 minutes.", "time": 48190},
      {"line": "Cut duck into inch thick pieces.", "time": 63130}
   ]
}`);

// VIDEO ID:
const squashprep = JSON.parse(`{
   "recipe": [
      {"line": "Gather tools and ingredients, and preheat oven to 450 degrees Fahrenheit.", "time": 0},
      {"line": "Prep your squash - cut off top, cut in half, and scoop out seeds into a small bowl.", "time": 8080},
      {"line": "Remove skin with a very sharp knife - paring knife will help get smaller hard to reach places.", "time": 48150},
      {"line": "Cut into 1/4 inch thick pieces.", "time": 109080},
      {"line": "Drizzle with olive oil and season with 1/2 tsp paprika, cumin, salt, white pepper, a clove of minced garlic, and 1/2 inch minced ginger.", "time": 142120},
      {"line": "Stir until squash is evenly coated in seasoning.", "time": 237170},
      {"line": "Spread squash pieces out on a baking sheet.", "time": 257050},
      {"line": "Toss the seeds in olive oil in a small bowl.", "time": 281090},
      {"line": "Spread out on a baking sheet and sprinkle with salt and pepper from a foot away.", "time": 297190}
   ]
}`);

// VIDEO ID:
const squashcook = JSON.parse(`{
   "recipe": [
      {"line": "Put acorn squash in the oven and roast for 10 minutes at 450 degrees Fahrenheit.", "time": 0},
      {"line": "Add squash seeds to the oven, and roast both the squash and seeds for an additional 5 minutes.", "time": 8100},
      {"line": "Remove from oven and allow seed to cool completely so they become crisp.", "time": 24130}
   ]
}`);

document.getElementById("ingredients").style.display = "block";
document.getElementById("tab-ingredients").style.color = "#FF561B";

function changetab(toggletab) {
   if (toggletab == "Ingredients") {
      document.getElementById("ingredients").style.display = "block";
      document.getElementById("tab-ingredients").style.color = "#FF561B";
      document.getElementById("equipment").style.display = "none";
      document.getElementById("tab-equipment").style.color = "black";
   }
   else if (toggletab == "Equipment") {
      document.getElementById("equipment").style.display = "block";
      document.getElementById("tab-equipment").style.color = "#FF561B";
      document.getElementById("ingredients").style.display = "none";
      document.getElementById("tab-ingredients").style.color = "black";
   }
}

// ytplayer code: https://developers.google.com/youtube/player_parameters#IFrame_Player_API
let tag = document.createElement('script');
tag.src = "https://www.youtube.com/player_api";
let firstScriptTag = document.getElementsByTagName('script')[0];
firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);
let videoId = document.getElementsByTagName("main")[0].id;
let player;
function onYouTubePlayerAPIReady() {
   // Soy Cured Egg
   if (videoId == "soy-cured-egg") {
      player = new YT.Player('ytplayer', {
         height: '500',
         width: '980',
         videoId: 'Gqay2XoYqcY',
         playerVars: {
            'controls': 0,
            'showinfo': 0,
            'rel': 0,
            'loop': 1
         },
         events: {
            'onStateChange': onStateChange
         }
      });
   }
   // Seared Sirloin
   else if (videoId == "seared-sirloin") {
      player = new YT.Player('ytplayer', {
         height: '500',
         width: '980',
         videoId: 'xlnvkOemQI4',
         playerVars: {
            'controls': 0,
            'showinfo': 0,
            'rel': 0,
            'loop': 1
         },
         events: {
            'onStateChange': onStateChange
         }
      });
   }
   // Shiitake Mushrooms
   else if (videoId == "shiitake-mushrooms") {
      player = new YT.Player('ytplayer', {
         height: '500',
         width: '980',
         videoId: 'XeRD00WTsQ8',
         playerVars: {
            'controls': 0,
            'showinfo': 0,
            'rel': 0,
            'loop': 1
         },
         events: {
            'onStateChange': onStateChange
         }
      });
   }
   // Aromatic Rice
   else if (videoId == "aromatic-rice") {
      player = new YT.Player('ytplayer', {
         height: '500',
         width: '980',
         videoId: '',
         playerVars: {
            'controls': 0,
            'showinfo': 0,
            'rel': 0,
            'loop': 1
         },
         events: {
            'onStateChange': onStateChange
         }
      });
   }
}

let recipeVideo;

let i = 0;
let next = false;
let previous = false;
function interactiveCaptions() {
   if (next) {
      i++;
      console.log(i);
      console.log("next video");
      next = false;
   }
   else if (previous) {
      i--;
      previous = false;
   }
   if (videoId == "soy-cured-egg") {
      if ((player.getCurrentTime() * 1000) >= parseInt(soycuredegg["recipe"][i]["time"])) {
         document.getElementById("captions").innerHTML = soycuredegg["recipe"][i]["line"];
         if (i + 1 < soycuredegg["recipe"].length) {
            if ((player.getCurrentTime() * 1000) >= parseInt(soycuredegg["recipe"][i + 1]["time"])) {
               player.seekTo(parseInt(soycuredegg["recipe"][i]["time"])/1000);
            }
         }
      }
   }
   if (videoId == "seared-sirloin") {
      if (recipeVideo == "steakprep") {
         if ((player.getCurrentTime() * 1000) >= parseInt(steakprep["recipe"][i]["time"])) {
            document.getElementById("captions").innerHTML = steakprep["recipe"][i]["line"];
            console.log(i);
            if (i + 1 < steakprep["recipe"].length) {
               if ((player.getCurrentTime() * 1000) >= parseInt(steakprep["recipe"][i + 1]["time"])) {
                  player.seekTo(parseInt(steakprep["recipe"][i]["time"])/1000);
               }
            }
         }
      }
      if (recipeVideo == "steakcook") {
         if ((player.getCurrentTime() * 1000) >= parseInt(steakcook["recipe"][i]["time"])) {
            document.getElementById("captions").innerHTML = steakcook["recipe"][i]["line"];
            if (i + 1 < steakcook["recipe"].length) {
               if ((player.getCurrentTime() * 1000) >= parseInt(steakcook["recipe"][i + 1]["time"])) {
                  player.seekTo(parseInt(steakcook["recipe"][i]["time"])/1000);
               }
            }
         }
      }
   }
   if (videoId == "braised-cherries") {
      if ((player.getCurrentTime() * 1000) >= parseInt(braisedcherries["recipe"][i]["time"])) {
         document.getElementById("captions").innerHTML = braisedcherries["recipe"][i]["line"];
         if (i + 1 < braisedcherries["recipe"].length) {
            if ((player.getCurrentTime() * 1000) >= parseInt(braisedcherries["recipe"][i + 1]["time"])) {
               player.seekTo(parseInt(braisedcherries["recipe"][i]["time"])/1000);
            }
         }
      }
   }
   if (videoId == "shiitake-mushrooms") {
      if (recipeVideo == "mushroomprep") {
         if ((player.getCurrentTime() * 1000) >= parseInt(mushroomprep["recipe"][i]["time"])) {
            document.getElementById("captions").innerHTML = mushroomprep["recipe"][i]["line"];
            if (i + 1 < mushroomprep["recipe"].length) {
               if ((player.getCurrentTime() * 1000) >= parseInt(mushroomprep["recipe"][i + 1]["time"])) {
                  player.seekTo(parseInt(mushroomprep["recipe"][i]["time"])/1000);
               }
            }
         }
      }
      if (recipeVideo == "mushroomcook") {
         if ((player.getCurrentTime() * 1000) >= parseInt(mushroomcook["recipe"][i]["time"])) {
            document.getElementById("captions").innerHTML = mushroomcook["recipe"][i]["line"];
            if (i + 1 < mushroomcook["recipe"].length) {
               if ((player.getCurrentTime() * 1000) >= parseInt(mushroomcook["recipe"][i + 1]["time"])) {
                  player.seekTo(parseInt(mushroomcook["recipe"][i]["time"])/1000);
               }
            }
         }
      }
   }
}

// Keep loop
// Start the timer when the video plays
let timer;
function onStateChange(event) {
   if (event.data == YT.PlayerState.PLAYING) {
      timer = window.setInterval(interactiveCaptions, 100);
      if (player.getVideoUrl() == "https://www.youtube.com/watch?v=xlnvkOemQI4") {
         recipeVideo = "steakprep";
      }
      if (player.getVideoUrl() == "https://www.youtube.com/watch?v=R_QLdbfLGZ0") {
         recipeVideo = "steakcook";
      }
      if (player.getVideoUrl() == "https://www.youtube.com/watch?v=XeRD00WTsQ8") {
         recipeVideo = "mushroomprep";
      }
      if (player.getVideoUrl() == "https://www.youtube.com/watch?v=bNdiE0umUZc") {
         recipeVideo = "mushroomcook";
      }
   }
   if (event.data == YT.PlayerState.ENDED) {
      window.clearInterval(timer);
   }
}

function nextStep() {
   if (videoId == "soy-cured-egg") {
      if (i + 1 < soycuredegg["recipe"].length) {
         player.seekTo(parseInt(soycuredegg["recipe"][i + 1]["time"])/1000);
         next = true;
      }
   }
   if (videoId == "seared-sirloin") {
      if (recipeVideo == "steakprep") {
         if (i + 1 < steakprep["recipe"].length) {
            player.seekTo(parseInt(steakprep["recipe"][i + 1]["time"])/1000);
            next = true;
         }
      }
      if (recipeVideo == "steakcook") {
         if (i + 1 < steakcook["recipe"].length) {
            document.getElementById("captions").innerHTML = steakcook["recipe"][i + 1]["line"];
            player.seekTo(parseInt(steakcook["recipe"][i + 1]["time"])/1000);
            next = true;
         }
      }
   }
   if (videoId == "braised-cherries") {
      if (i + 1 < braisecherries["recipe"].length) {
         player.seekTo(parseInt(braisedcherries["recipe"][i + 1]["time"])/1000);
         next = true;
      }
   }
   if (videoId == "shiitake-mushrooms") {
      if (recipeVideo == "mushroomprep") {
         if (i + 1 < mushroomprep["recipe"].length) {
            player.seekTo(parseInt(mushroomprep["recipe"][i + 1]["time"])/1000);
            next = true;
         }
      }
      if (recipeVideo == "mushroomcook") {
         if (i + 1 < mushroomcook["recipe"].length) {
            player.seekTo(parseInt(mushroomcook["recipe"][i + 1]["time"])/1000);
            next = true;
         }
      }
   }
}
function previousStep() {
   if (videoId == "soy-cured-egg") {
      if (i - 1 > -1) {
         player.seekTo(parseInt(soycuredegg["recipe"][i - 1]["time"])/1000);
         document.getElementById("captions").innerHTML = soycuredegg["recipe"][i - 1]["line"];
         previous = true;
      }
   }
   if (videoId == "seared-sirloin") {
      if (recipeVideo == "steakprep") {
         if (i - 1 > -1) {
            player.seekTo(parseInt(steakprep["recipe"][i - 1]["time"])/1000);
            document.getElementById("captions").innerHTML = steakprep["recipe"][i - 1]["line"];
            previous = true;
         }
      }
      if (recipeVideo == "steakcook") {
         if (i - 1 > -1) {
            player.seekTo(parseInt(steakcook["recipe"][i - 1]["time"])/1000);
            document.getElementById("captions").innerHTML = steakcook["recipe"][i - 1]["line"];
            previous = true;
         }
      }
   }
   if (videoId == "braised-cherries") {
      if (i - 1 > -1) {
         player.seekTo(parseInt(braisedcherries["recipe"][i - 1]["time"])/1000);
         document.getElementById("captions").innerHTML = braisedcherries["recipe"][i - 1]["line"];
         previous = true;
      }
   }
   if (videoId == "shiitake-mushrooms") {
      if (recipeVideo == "mushroomprep") {
         if (i - 1 > -1) {
            player.seekTo(parseInt(mushroomprep["recipe"][i - 1]["time"])/1000);
            document.getElementById("captions").innerHTML = mushroomprep["recipe"][i - 1]["line"];
            previous = true;
         }
      }
      if (recipeVideo == "mushroomcook") {
         if (i - 1 > -1) {
            player.seekTo(parseInt(mushroomcook["recipe"][i - 1]["time"])/1000);
            document.getElementById("captions").innerHTML = mushroomcook["recipe"][i - 1]["line"];
            previous = true;
         }
      }
   }
}

function changeVideo(prepOrCook) {
   if (videoId == "seared-sirloin") {
      if (prepOrCook == "Prep") {
         player.loadVideoById("xlnvkOemQI4");
         i = 0;
      }
      else if (prepOrCook == "Cook"){
         player.loadVideoById("R_QLdbfLGZ0");
         i = 0;
      }
   }
   else if (videoId == "shiitake-mushrooms") {
      if (prepOrCook == "Prep") {
         player.loadVideoById("XeRD00WTsQ8");
         i = 0;
      }
      else if (prepOrCook == "Cook") {
         player.loadVideoById("bNdiE0umUZc");
         i = 0;
      }
   }
}